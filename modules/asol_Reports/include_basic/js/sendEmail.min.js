function RememberEmails(emailField) {
	
	var emailInfo = emailField.split("${pipe}");
	
	// "all"-tab
	if (typeof emailInfo[0] != 'undefined') {
		document.getElementById("email_from").value = emailInfo[0];
	}
	
	// to,cc,bcc tabs
	var to_cc_bcc = {1:'to', 2:'cc', 3:'bcc'};
	for (var index in to_cc_bcc) {
		
		index = parseInt(index);// problems adding: "index+3" (literal + number)
		
		// users select: to,cc,bcc -->(1,2,3)
		if (typeof emailInfo[index] != 'undefined') {
			users_selected = emailInfo[index].split("${comma}");
			
			for (var i=0; i< document.getElementById("email_users_for_"+to_cc_bcc[index]).options.length; i++) {
				for (var j=0; j< users_selected.length; j++) {
					if (document.getElementById("email_users_for_"+to_cc_bcc[index]).options[i].value == users_selected[j]) {
						document.getElementById("email_users_for_"+to_cc_bcc[index]).options[i].selected = "true";
						
						document.getElementById("email_users_for_"+to_cc_bcc[index]+"_readonly").value += document.getElementById("email_users_for_"+to_cc_bcc[index]).options[i].innerHTML + ',';
					}
				}
			}
			document.getElementById("email_users_for_"+to_cc_bcc[index]+"_readonly").value = document.getElementById("email_users_for_"+to_cc_bcc[index]+"_readonly").value.slice(0,-1);
		}
		
		// acl_roles select: to,cc,bcc -->(4,5,6)
		if (typeof emailInfo[index+3] != 'undefined') {
			roles_selected = emailInfo[index+3].split("${comma}");
			
			//document.getElementById("email_roles_for_"+to_cc_bcc[index]+"_readonly").value = emailInfo[index+3].replace(/${comma}/g,',');
			
			for (var i=0; i< document.getElementById("email_roles_for_"+to_cc_bcc[index]).options.length; i++) {
				for (var j=0; j< roles_selected.length; j++) {
					if (document.getElementById("email_roles_for_"+to_cc_bcc[index]).options[i].value == roles_selected[j]) {
						document.getElementById("email_roles_for_"+to_cc_bcc[index]).options[i].selected = "true";
						
						document.getElementById("email_roles_for_"+to_cc_bcc[index]+"_readonly").value += document.getElementById("email_roles_for_"+to_cc_bcc[index]).options[i].innerHTML + ',';
					}
				}
			}
			document.getElementById("email_roles_for_"+to_cc_bcc[index]+"_readonly").value = document.getElementById("email_roles_for_"+to_cc_bcc[index]+"_readonly").value.slice(0,-1);
		}
		
		// email_list textarea: to,cc,bcc -->(7,8,9)
		if (typeof emailInfo[index+6] != 'undefined') {
			document.getElementById("email_list_for_"+to_cc_bcc[index]).value = unescape(emailInfo[index+6]);
			
			document.getElementById("email_list_for_"+to_cc_bcc[index]+"_readonly").value = unescape(emailInfo[index+6]);
		}
		
	}
			
}

function selected_option_task(users_opts, acl_roles_opts) {

	// BEGIN - Language Labels
	var lbl_send_email_from = SUGAR.language.get('asol_Reports', 'LBL_REPORT_SEND_EMAIL_FROM');
	var lbl_send_email_all = SUGAR.language.get('asol_Reports', 'LBL_REPORT_SEND_EMAIL_ALL');
	var lbl_send_email_all_tip = SUGAR.language.get('asol_Reports', 'LBL_REPORT_SEND_EMAIL_ALL_TIP');
	var lbl_send_email_to = SUGAR.language.get('asol_Reports', 'LBL_REPORT_SEND_EMAIL_TO');
	var lbl_send_email_cc = SUGAR.language.get('asol_Reports', 'LBL_REPORT_SEND_EMAIL_CC');
	var lbl_send_email_bcc = SUGAR.language.get('asol_Reports', 'LBL_REPORT_SEND_EMAIL_BCC');
	var lbl_send_email_users = SUGAR.language.get('asol_Reports', 'LBL_REPORT_SEND_EMAIL_USERS');
	var lbl_send_email_roles = SUGAR.language.get('asol_Reports', 'LBL_REPORT_SEND_EMAIL_ROLES');
	var lbl_send_email_distribution_list = SUGAR.language.get('asol_Reports', 'LBL_REPORT_DISTRIBUTION_LIST');
	// END - Language Labels
	
	var users = ((users_opts=="")||(users_opts==null)) ? new Array() : users_opts.split("${pipe}");
	var acl_roles = ((acl_roles_opts=="")||(acl_roles_opts==null)) ? new Array() : acl_roles_opts.split("${pipe}");
	
	// users select: to,cc,bcc
	var users_select_for_to =  generate_SendEmail_UsersSelect_HTML('to', users);
	var users_select_for_cc =  generate_SendEmail_UsersSelect_HTML('cc', users);
	var users_select_for_bcc =  generate_SendEmail_UsersSelect_HTML('bcc', users);
	
	// acl_roles select: to,cc,bcc
	var acl_roles_select_for_to = generate_SendEmail_AclrolesSelect_HTML('to', acl_roles);
	var acl_roles_select_for_cc = generate_SendEmail_AclrolesSelect_HTML('cc', acl_roles);
	var acl_roles_select_for_bcc = generate_SendEmail_AclrolesSelect_HTML('bcc', acl_roles);
	
	var menu_to_cc_bcc_HTML = ""
		+ "<ul class='yui-nav' id='emailTabs'>"
	    	+ "<li class='selected'><a href='javascript: void(0);' id='all_Tab' onClick='refresh_to_cc_bcc_readonly(); manageReportManagementTabs(\"emailTabs\", \"all\", \"emailPanel\");'><em>"+lbl_send_email_all+"</em></a></li>"
	    	+ "<li><a href='javascript: void(0);' id='to_Tab' onClick='manageReportManagementTabs(\"emailTabs\", \"to\", \"emailPanel\");'><em>"+lbl_send_email_to+"</em></a></li>"
	    	+ "<li><a href='javascript: void(0);' id='cc_Tab' onClick='manageReportManagementTabs(\"emailTabs\", \"cc\", \"emailPanel\");'><em>"+lbl_send_email_cc+"</em></a></li>"
	    	+ "<li><a href='javascript: void(0);' id='bcc_Tab' onClick='manageReportManagementTabs(\"emailTabs\", \"bcc\", \"emailPanel\");'><em>"+lbl_send_email_bcc+"</em></a></li>"
		+ "</ul>"
		;
			
	var select_all_HTML = ""
		+ "<div class='emailPanel' id='all'>"
    	+ "<h2>"+lbl_send_email_all+" "+lbl_send_email_all_tip+"</h2>"
    	
    	+ "<table class='edit view'>"
    	+ "<tr>"
		+ "<td>"+lbl_send_email_from+":</td>"
		+ "<td><input type='text' id='email_from' name='email_from' value='' onmouseover='this.title=this.value;'></td>"
		+ "<td></td>"
		+ "<td></td>"
		+ "</tr>"
		
		/////////////////////////
		
		
		//to
		+ "<tr>"
		+ "<td>"+lbl_send_email_to+":</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_users+"</td>"
		+ "<td>"+"<input id='email_users_for_to_readonly' type='text' readonly='' class='send_email_summary' onmouseover='this.title=this.value;' />"+"</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_roles+"</td>"
		+ "<td>"+"<input id='email_roles_for_to_readonly' type='text' readonly='' class='send_email_summary' onmouseover='this.title=this.value;' />"+"</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_distribution_list+":</td>"
		+ "<td><textarea id='email_list_for_to_readonly' name='email_list_for_to' type='text' readonly='' class='send_email_summary' onmouseover='this.title=this.value;'></textarea></td>"
		+ "<td colspan='2'></td>" 
		+ "</tr>"
		
		//cc
		+ "<tr>"
		+ "<td>"+lbl_send_email_cc+":</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_users+"</td>"
		+ "<td>"+"<input id='email_users_for_cc_readonly' type='text' readonly='' class='send_email_summary' onmouseover='this.title=this.value;' />"+"</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_roles+"</td>"
		+ "<td>"+"<input id='email_roles_for_cc_readonly' type='text' readonly='' class='send_email_summary' onmouseover='this.title=this.value;' />"+"</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_distribution_list+":</td>"
		+ "<td><textarea id='email_list_for_cc_readonly' name='email_list_for_to' type='text' readonly='' class='send_email_summary' onmouseover='this.title=this.value;' ></textarea></td>"
		+ "<td colspan='2'></td>" 
		+ "</tr>"
		
		//bcc
		+ "<tr>"
		+ "<td>"+lbl_send_email_bcc+":</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_users+"</td>"
		+ "<td>"+"<input id='email_users_for_bcc_readonly' type='text' readonly='' class='send_email_summary' onmouseover='this.title=this.value;' />"+"</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_roles+"</td>"
		+ "<td>"+"<input id='email_roles_for_bcc_readonly' type='text' readonly='' class='send_email_summary' onmouseover='this.title=this.value;' />"+"</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_distribution_list+":</td>"
		+ "<td><textarea id='email_list_for_bcc_readonly' name='email_list_for_to' type='text' readonly='' class='send_email_summary' onmouseover='this.title=this.value;' ></textarea></td>"
		+ "<td colspan='2'></td>" 
		+ "</tr>"
		
		///////////////////////////
		
		+ "</table>"
		
    	+ "</div>"
		;
		
	var select_to_HTML = ""
		+ "<div class='emailPanel' id='to' style='display: none;'>"
    	+ "<h2>"+lbl_send_email_to+"</h2>"
    	
    	+ "<table class='edit view'>"
    	
		+ "<tr>"
		+ "<td>"+lbl_send_email_users+"</td>"
		+ "<td>"+users_select_for_to+"</td>"
		+ "<td>"+lbl_send_email_roles+"</td>"
		+ "<td>"+acl_roles_select_for_to+"</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_distribution_list+":</td>"
		+ "<td><textarea id='email_list_for_to' name='email_list_for_to' rows='6' cols='40'></textarea></td>"
		+ "<td colspan='2'></td>" 
		+ "</tr>"
		
		+ "</table>"
		
		+ "</div>"
		;
	
	var select_cc_HTML = ""
		+ "<div class='emailPanel' id='cc' style='display: none;'>"
    	+ "<h2>"+lbl_send_email_cc+"</h2>"
    	
    	+ "<table class='edit view'>"
    	
		+ "<tr>"
		+ "<td>"+lbl_send_email_users+"</td>"
		+ "<td>"+users_select_for_cc+"</td>"
		+ "<td>"+lbl_send_email_roles+"</td>"
		+ "<td>"+acl_roles_select_for_cc+"</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_distribution_list+":</td>"
		+ "<td><textarea id='email_list_for_cc' name='email_list_for_cc' rows='6' cols='40'></textarea></td>"
		+ "<td colspan='2'></td>" 
		+ "</tr>" 
		
		+ "</table>"
		
		+ "</div>"
		;
	
	var select_bcc_HTML = ""
		+ "<div class='emailPanel' id='bcc' style='display: none;'>"
    	+ "<h2>"+lbl_send_email_bcc+"</h2>"
    	
    	+ "<table class='edit view'>"
    	
		+ "<tr>"
		+ "<td>"+lbl_send_email_users+"</td>"
		+ "<td>"+users_select_for_bcc+"</td>"
		+ "<td>"+lbl_send_email_roles+"</td>"
		+ "<td>"+acl_roles_select_for_bcc+"</td>"
		+ "</tr>"
		+ "<tr>"
		+ "<td>"+lbl_send_email_distribution_list+":</td>"
		+ "<td><textarea id='email_list_for_bcc' name='email_list_for_bcc' rows='6' cols='40'></textarea></td>"
		+ "<td colspan='2'></td>" 
		+ "</tr>"
		
		+ "</table>"
		
		+ "</div>"
		;
	
	document.getElementById("task_implementation_field").innerHTML += ""
		+ menu_to_cc_bcc_HTML
		+ "<div class='yui-content'>"
		+ select_all_HTML
		+ select_to_HTML
		+ select_cc_HTML
		+ select_bcc_HTML
		+ "</div>";

}

function format_email_list() {
	
	var formated_string = "";

	var to_cc_bcc = {3:'to', 4:'cc', 5:'bcc'};
	var users_opts_string_for = [];
	var acl_roles_opts_string_for = [];
	var email_list_for = [];
	for (var index in to_cc_bcc) {
		users_opts_string_for[to_cc_bcc[index]] 	= get_Emails_from_UsersSelect(to_cc_bcc[index]);
		acl_roles_opts_string_for[to_cc_bcc[index]] = get_Emails_from_AclrolesSelect(to_cc_bcc[index]);
		email_list_for[to_cc_bcc[index]] = (document.getElementById('email_list_for_'+to_cc_bcc[index]).value).replace(/ /g,'').replace(/\n/g,'');
	}
	
	formated_string = ""
		+ document.getElementById('email_from').value
		
		+ "${pipe}" + users_opts_string_for['to']
		+ "${pipe}" + users_opts_string_for['cc'] 
		+ "${pipe}" + users_opts_string_for['bcc']
		
		+ "${pipe}"	+ acl_roles_opts_string_for['to']
		+ "${pipe}"	+ acl_roles_opts_string_for['cc']
		+ "${pipe}"	+ acl_roles_opts_string_for['bcc']
		
		+ "${pipe}"	+ escape(email_list_for['to'])
		+ "${pipe}"	+ escape(email_list_for['cc'])
		+ "${pipe}"	+ escape(email_list_for['bcc']);
	
	
	return formated_string;
	
}

function get_Emails_from_UsersSelect(to_cc_bcc) {
	
	var users_opts_string = "";
	for (var i = 0; i < document.getElementById('email_users_for_'+to_cc_bcc).options.length; i++) {
		if (document.getElementById('email_users_for_'+to_cc_bcc).options[i].selected) {
			users_opts_string += document.getElementById('email_users_for_'+to_cc_bcc).options[i].value + "${comma}";
		}
	}
	users_opts_string = users_opts_string.slice(0, -8);
	
	return users_opts_string;
}

function get_Emails_from_AclrolesSelect(to_cc_bcc) {

	var acl_roles_opts_string = "";
	for (var i = 0; i < document.getElementById('email_roles_for_'+to_cc_bcc).options.length; i++) {
		if (document.getElementById('email_roles_for_'+to_cc_bcc).options[i].selected) {
			acl_roles_opts_string += document.getElementById('email_roles_for_'+to_cc_bcc).options[i].value + "${comma}";
		}
	}
	acl_roles_opts_string = acl_roles_opts_string.slice(0, -8);

	return acl_roles_opts_string;
}

function generate_SendEmail_UsersSelect_HTML(to_cc_bcc, users) {
	
	var users_select = "<select id='email_users_for_"+to_cc_bcc+"' name='email_users_for_"+to_cc_bcc+"' multiple='' size=4 style='width: 140px'>";
	for (var i = 0; i < users.length; i++) {
		var user = users[i].split("${comma}");
		users_select += "<option value='" + user[0] + "'>" + user[1] + "</option>";
	}
	users_select += "</select>";
	
	return users_select
}

function generate_SendEmail_AclrolesSelect_HTML(to_cc_bcc, acl_roles) {
	
	var acl_roles_select = "<select id='email_roles_for_"+to_cc_bcc+"' name='email_roles_for_"+to_cc_bcc+"' multiple='' size=4 style='width: 140px'>";
	for (var i = 0; i < acl_roles.length; i++) {
		var acl_role = acl_roles[i].split("${comma}");
		acl_roles_select += "<option value='" + acl_role[0] + "'>" + acl_role[1] + "</option>";
	}
	acl_roles_select += "</select>";
	
	return acl_roles_select;
}

function refresh_to_cc_bcc_readonly() {
	var to_cc_bcc = {0:'to', 1:'cc', 2:'bcc'};
	for (var index in to_cc_bcc) {
		var users_roles = {0:'users', 1:'roles'};
		for (var index2 in users_roles) {
			var selected_options = $.map($("#email_"+users_roles[index2]+"_for_"+to_cc_bcc[index]+" option:selected"), function(e) { return $(e).text(); });
			$("#email_"+users_roles[index2]+"_for_"+to_cc_bcc[index]+"_readonly").val(selected_options.join(","));
		}
		$("#email_list_for_"+to_cc_bcc[index]+"_readonly").val($("#email_list_for_"+to_cc_bcc[index]).val());
	}
}